name: Flow Coverage Report

on:
  push:
    paths: ["src/*.js"]

jobs:
  build:
    runs-on: ubuntu-latest
    name: Test changed-files
    steps:
    - uses: actions/checkout@v3
      with:
        fetch-depth: 0

    - name: Get changed files
      id: changed-files
      uses: tj-actions/changed-files@v34

    - name: Install modules
      run: |
        yarn install

    - name: Run flow coverage on changed files
      run: |
        coverage_res="Flow coverage report:"
        for file in ${{ steps.changed-files.outputs.all_changed_files }}; do
          if [ $file != "src/setupProxy.js" ]; then
            # setupProxy.js is not covered by flow.
            coverage_res=$coverage_res"\n"$file$(yarn flow coverage --quiet $file | grep -o ": .*")
          fi
        done
        echo $coverage_res
